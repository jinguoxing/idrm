# æ•…éšœæ’æŸ¥æŒ‡å—

> Troubleshooting - é‡åˆ°é—®é¢˜ä¸è¦æ…Œ

---

## ğŸ¯ æœ¬æ–‡æ¡£ç›®æ ‡

å¿«é€Ÿè¯Šæ–­å’Œè§£å†³AIç¼–ç¨‹è¿‡ç¨‹ä¸­çš„å¸¸è§é—®é¢˜ã€‚

---

## ğŸ“‹ é—®é¢˜åˆ†ç±»

### 1. å·¥å…·é…ç½®é—®é¢˜
### 2. AIç”Ÿæˆä»£ç é—®é¢˜
### 3. ç¼–è¯‘å’Œè¿è¡Œé—®é¢˜
### 4. æµ‹è¯•é—®é¢˜
### 5. è´¨é‡é—¨ç¦é—®é¢˜
### 6. Gitå’Œåä½œé—®é¢˜

---

## ğŸ”§ 1. å·¥å…·é…ç½®é—®é¢˜

### Problem 1.1: Cursorä¸è¯»å–.cursorrules

**ç—‡çŠ¶**ï¼š
- Cursorä¸æŒ‰è§„èŒƒç”Ÿæˆä»£ç 
- AIä¸ç†è§£é¡¹ç›®è§„èŒƒ

**è¯Šæ–­**ï¼š
```bash
# æ£€æŸ¥.cursorrulesæ˜¯å¦å­˜åœ¨
ls -la .cursorrules

# æ£€æŸ¥æ–‡ä»¶å†…å®¹
cat .cursorrules
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ¡ˆ1ï¼šé‡å¯Cursor
# Cmd+Q å®Œå…¨é€€å‡º
# é‡æ–°æ‰“å¼€é¡¹ç›®

# æ–¹æ¡ˆ2ï¼šæ£€æŸ¥æ–‡ä»¶ä½ç½®
# .cursorruleså¿…é¡»åœ¨é¡¹ç›®æ ¹ç›®å½•

# æ–¹æ¡ˆ3ï¼šé‡æ–°åˆ›å»º
cp sdd_doc/spec/tools/cursor/.cursorrules.template .cursorrules
```

**é¢„é˜²æªæ–½**ï¼š
- å®šæœŸæ£€æŸ¥.cursorrulesæ˜¯å¦å­˜åœ¨
- å°†.cursorrulesåŠ å…¥ç‰ˆæœ¬æ§åˆ¶

---

### Problem 1.2: Claude CLIè¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
Error: API key not valid
æˆ–
Error: Connection timeout
```

**è¯Šæ–­**ï¼š
```bash
# æ£€æŸ¥API Key
echo $ANTHROPIC_API_KEY

# æµ‹è¯•è¿æ¥
claude "hello"
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ¡ˆ1ï¼šè®¾ç½®API Key
export ANTHROPIC_API_KEY="your-key-here"

# æ–¹æ¡ˆ2ï¼šå†™å…¥é…ç½®æ–‡ä»¶
echo 'export ANTHROPIC_API_KEY="your-key"' >> ~/.zshrc
source ~/.zshrc

# æ–¹æ¡ˆ3ï¼šæ£€æŸ¥ç½‘ç»œ
ping api.anthropic.com
```

---

### Problem 1.3: Kiro.dev Steeringä¸ç”Ÿæ•ˆ

**ç—‡çŠ¶**ï¼š
- Kiroç”Ÿæˆçš„ä»£ç ä¸ç¬¦åˆIDRMè§„èŒƒ
- æ²¡æœ‰å¼•ç”¨é¡¹ç›®è§„èŒƒ

**è¯Šæ–­**ï¼š
```bash
# æ£€æŸ¥steeringæ–‡ä»¶
ls -la .kiro/steering/

# æ£€æŸ¥å†…å®¹
cat .kiro/steering/idrm-rules.md
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿æ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼š`.kiro/steering/*.md`
2. åœ¨Kiroç•Œé¢ä¸­æ‰‹åŠ¨åˆ·æ–°Steering
3. é‡æ–°è¿æ¥é¡¹ç›®

---

## ğŸ’» 2. AIç”Ÿæˆä»£ç é—®é¢˜

### Problem 2.1: AIç”Ÿæˆä»£ç ä¸ç¬¦åˆè§„èŒƒ

**ç—‡çŠ¶**ï¼š
- å‡½æ•°>50è¡Œ
- æ²¡æœ‰ä¸­æ–‡æ³¨é‡Š
- ä¸éµå¾ªåˆ†å±‚æ¶æ„

**è¯Šæ–­**ï¼š
æ£€æŸ¥promptæ˜¯å¦å¼•ç”¨äº†è§„èŒƒï¼š
```
âŒ é”™è¯¯ï¼š
"åˆ›å»ºCategory Handler"

âœ… æ­£ç¡®ï¼š
@spec/architecture/layered-architecture.md
@spec/coding-standards/go-style-guide.md
åˆ›å»ºCategory Handler
è¦æ±‚ï¼š
- å‡½æ•°<50è¡Œ
- ä¸­æ–‡æ³¨é‡Š
- éµå¾ªåˆ†å±‚æ¶æ„
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
**æ–¹æ¡ˆ1ï¼šå®Œå–„Prompt**
```
@sdd_doc/spec/core/workflow.md
@sdd_doc/spec/architecture/layered-architecture.md
@sdd_doc/spec/coding-standards/go-style-guide.md

{ä½ çš„éœ€æ±‚}

è¦æ±‚ï¼š
1. éµå¾ª5é˜¶æ®µå·¥ä½œæµ
2. åˆ†å±‚æ¶æ„ï¼šHandler â†’ Logic â†’ Model
3. å‡½æ•°<50è¡Œ
4. å®Œæ•´ä¸­æ–‡æ³¨é‡Š
5. é”™è¯¯å¤„ç†ç”¨%w
```

**æ–¹æ¡ˆ2ï¼šè¿­ä»£ä¿®æ­£**
```
@åˆšç”Ÿæˆçš„ä»£ç 
@spec/coding-standards/go-style-guide.md

ä¿®å¤è¿™ä¸ªä»£ç ï¼š
1. å‡½æ•°>50è¡Œçš„æ‹†åˆ†
2. è¡¥å……ä¸­æ–‡æ³¨é‡Š
3. ä¼˜åŒ–é”™è¯¯å¤„ç†
```

---

### Problem 2.2: AIå¹»è§‰é—®é¢˜

**ç—‡çŠ¶**ï¼š
- ç”Ÿæˆä¸å­˜åœ¨çš„å‡½æ•°/åŒ…
- å¼•ç”¨é”™è¯¯çš„API
- é€»è¾‘æ˜æ˜¾é”™è¯¯

**ç¤ºä¾‹**ï¼š
```go
// AIå¹»è§‰ç¤ºä¾‹
import "github.com/notexist/package"  // âŒ åŒ…ä¸å­˜åœ¨

model.FindAll() // âŒ æ–¹æ³•ä¸å­˜åœ¨
```

**è¯Šæ–­**ï¼š
```bash
# ç¼–è¯‘æ£€æŸ¥ä¼šå‘ç°
go build ./...
# undefined: xxx
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
**æ–¹æ¡ˆ1ï¼šæ˜ç¡®å¼•ç”¨ç°æœ‰ä»£ç **
```
@model/resource_catalog/category/interface.go

å‚è€ƒè¿™ä¸ªæ¥å£ï¼Œå®ç°Logicå±‚
ä¸è¦è‡ªå·±ç¼–é€ æ–¹æ³•å
```

**æ–¹æ¡ˆ2ï¼šåˆ†æ­¥éªŒè¯**
```
1. å…ˆè®©AIåˆ—å‡ºéœ€è¦è°ƒç”¨çš„æ–¹æ³•
2. éªŒè¯æ–¹æ³•æ˜¯å¦å­˜åœ¨
3. å†è®©AIç”Ÿæˆä»£ç 
```

**æ–¹æ¡ˆ3ï¼šäººå·¥Review**
- ç¼–è¯‘æ£€æŸ¥
- ä»”ç»†é˜…è¯»ç”Ÿæˆä»£ç 
- å¯ç–‘çš„åœ°æ–¹ç«‹å³éªŒè¯

---

### Problem 2.3: AIç”Ÿæˆä»£ç è¿‡äºå¤æ‚

**ç—‡çŠ¶**ï¼š
- è¿‡åº¦è®¾è®¡
- å¼•å…¥ä¸å¿…è¦çš„æŠ½è±¡
- ä»£ç éš¾ä»¥ç†è§£

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
@ç”Ÿæˆçš„ä»£ç 

ç®€åŒ–è¿™ä¸ªå®ç°ï¼š
1. ç§»é™¤ä¸å¿…è¦çš„æŠ½è±¡
2. ä½¿ç”¨æ›´ç›´æ¥çš„æ–¹å¼
3. ä¿æŒç®€å•ï¼ˆKISSåŸåˆ™ï¼‰
4. å‚è€ƒç°æœ‰ä»£ç é£æ ¼
```

---

## ğŸ”¨ 3. ç¼–è¯‘å’Œè¿è¡Œé—®é¢˜

### Problem 3.1: go buildå¤±è´¥

**ç—‡çŠ¶**ï¼š
```
undefined: xxx
cannot use xxx as type yyy
```

**è¯Šæ–­æ­¥éª¤**ï¼š
```bash
# 1. æ¸…ç†ç¼“å­˜
go clean -cache

# 2. æ›´æ–°ä¾èµ–
go mod tidy

# 3. é‡æ–°ç¼–è¯‘
go build ./...
```

**å¸¸è§åŸå› **ï¼š
1. **Importè·¯å¾„é”™è¯¯**
```go
// âŒ é”™è¯¯
import "idrm/model/category"

// âœ… æ­£ç¡®
import "devops.aishu.cn/AISHUDevOps/AnyFabric/_git/idrm/model/category"
```

2. **å¾ªç¯ä¾èµ–**
```
Handler â†’ Logic â†’ Handler  // âŒ
```
è§£å†³ï¼šæ£€æŸ¥importï¼Œç¡®ä¿å•å‘ä¾èµ–

3. **ç±»å‹ä¸åŒ¹é…**
```go
// æ£€æŸ¥å‡½æ•°ç­¾å
// æ£€æŸ¥æ¥å£å®ç°
```

---

### Problem 3.2: è¿è¡Œæ—¶panic

**ç—‡çŠ¶**ï¼š
```
panic: runtime error: invalid memory address
panic: index out of range
```

**è¯Šæ–­**ï¼š
```bash
# æŸ¥çœ‹stack trace
# panicä¿¡æ¯ä¼šæ˜¾ç¤ºå‡ºé”™ä½ç½®
```

**å¸¸è§åŸå› **ï¼š
1. **ç©ºæŒ‡é’ˆ**
```go
// âŒ æœªæ£€æŸ¥nil
result := model.FindOne(id)
name := result.Name  // panic if result is nil

// âœ… æ£€æŸ¥nil
result, err := model.FindOne(id)
if err != nil || result == nil {
    return err
}
name := result.Name
```

2. **æ•°ç»„è¶Šç•Œ**
```go
// âŒ æœªæ£€æŸ¥é•¿åº¦
item := items[0]  // panic if items is empty

// âœ… æ£€æŸ¥é•¿åº¦
if len(items) > 0 {
    item := items[0]
}
```

---

## ğŸ§ª 4. æµ‹è¯•é—®é¢˜

### Problem 4.1: æµ‹è¯•è¦†ç›–ç‡ä¸è¶³

**ç—‡çŠ¶**ï¼š
```
coverage: 65.5% of statements
```

**è¯Šæ–­**ï¼š
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html

# æ‰“å¼€HTMLæŸ¥çœ‹æœªè¦†ç›–ä»£ç 
open coverage.html
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **è¡¥å……è¾¹ç•Œæµ‹è¯•**
```go
tests := []struct {
    name string
    input int64
    want error
}{
    {"æ­£å¸¸å€¼", 1, nil},
    {"é›¶å€¼", 0, ErrInvalid},      // â† è¡¥å……
    {"è´Ÿå€¼", -1, ErrInvalid},      // â† è¡¥å……
    {"æœ€å¤§å€¼", math.MaxInt64, nil}, // â† è¡¥å……
}
```

2. **è¡¥å……é”™è¯¯è·¯å¾„**
```go
// æµ‹è¯•é”™è¯¯æƒ…å†µ
mockModel.EXPECT().
    FindOne(gomock.Any(), gomock.Any()).
    Return(nil, errors.New("db error"))  // â† æ¨¡æ‹Ÿé”™è¯¯
```

3. **ç”¨AIç”Ÿæˆ**
```
@logic/createcategorylogic.go
@coverage.html

ä¸ºæœªè¦†ç›–çš„ä»£ç ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
```

---

### Problem 4.2: Mockä¸å·¥ä½œ

**ç—‡çŠ¶**ï¼š
```
missing call(s) to *MockModel.Insert(...)
unexpected call to *MockModel.FindOne(...)
```

**è¯Šæ–­**ï¼š
Mock expectationå’Œå®é™…è°ƒç”¨ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**ï¼š
```go
// âŒ é”™è¯¯ï¼šå‚æ•°ä¸åŒ¹é…
mockModel.EXPECT().
    Insert(gomock.Any(), &Category{Name: "test"}).  // æœŸæœ›ç‰¹å®šå¯¹è±¡
    Return(nil)

// å®é™…è°ƒç”¨å¯èƒ½æ˜¯ä¸åŒçš„å¯¹è±¡å®ä¾‹

// âœ… æ­£ç¡®ï¼šä½¿ç”¨gomock.Any()
mockModel.EXPECT().
    Insert(gomock.Any(), gomock.Any()).  // æ¥å—ä»»ä½•å‚æ•°
    Return(nil)

// æˆ–ä½¿ç”¨Matcher
mockModel.EXPECT().
    Insert(gomock.Any(), 
        gomock.Cond(func(x interface{}) bool {
            cat := x.(*Category)
            return cat.Name == "test"
        })).
    Return(nil)
```

---

## ğŸšª 5. è´¨é‡é—¨ç¦é—®é¢˜

### Problem 5.1: golangci-lintæŠ¥é”™å¤ªå¤š

**ç—‡çŠ¶**ï¼š
```
hundreds of lint errors
```

**ä¼˜å…ˆçº§å¤„ç†**ï¼š
```bash
# 1. åªçœ‹errorçº§åˆ«
golangci-lint run --max-issues-per-linter=10

# 2. åªçœ‹ç‰¹å®šlinter
golangci-lint run --disable-all --enable=errcheck

# 3. è‡ªåŠ¨ä¿®å¤
golangci-lint run --fix
```

**å¸¸è§é”™è¯¯**ï¼š
1. **errcheck**: æœªæ£€æŸ¥é”™è¯¯
```go
// âŒ
file.Close()

// âœ…
defer file.Close()
// æˆ–
if err := file.Close(); err != nil {
    log.Error(err)
}
```

2. **ineffassign**: æ— æ•ˆèµ‹å€¼
```go
// âŒ
result := doSomething()
result = doOtherthing()  // ç¬¬ä¸€æ¬¡èµ‹å€¼è¢«è¦†ç›–

// âœ…
result := doOtherthing()
```

---

### Problem 5.2: æµ‹è¯•è¶…æ—¶

**ç—‡çŠ¶**ï¼š
```
panic: test timed out after 10m
```

**è¯Šæ–­**ï¼š
```bash
# æŸ¥çœ‹å“ªä¸ªæµ‹è¯•æ…¢
go test -v ./... | grep PASS

# å¸¦è¶…æ—¶è¿è¡Œ
go test -timeout 30s ./...
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **ä¼˜åŒ–æµ‹è¯•**
- ä½¿ç”¨å†…å­˜æ•°æ®åº“
- Mockå¤–éƒ¨è°ƒç”¨
- å¹¶è¡Œæµ‹è¯•

2. **å¢åŠ è¶…æ—¶**
```bash
go test -timeout 5m ./...
```

---

## ğŸ“¦ 6. Gitå’Œåä½œé—®é¢˜

### Problem 6.1: åˆå¹¶å†²çª

**ç—‡çŠ¶**ï¼š
```
CONFLICT (content): Merge conflict in xxx.go
```

**è§£å†³æ­¥éª¤**ï¼š
```bash
# 1. æŸ¥çœ‹å†²çªæ–‡ä»¶
git status

# 2. æ‰‹åŠ¨è§£å†³å†²çª
# ç¼–è¾‘æ–‡ä»¶ï¼Œç§»é™¤å†²çªæ ‡è®°
<<<<<<< HEAD
ä½ çš„ä»£ç 
=======
ä»–äººçš„ä»£ç 
>>>>>>> branch-name

# 3. æ ‡è®°å·²è§£å†³
git add xxx.go

# 4. ç»§ç»­åˆå¹¶
git commit
```

**ç”¨AIè¾…åŠ©**ï¼š
```
è¿™ä¸¤æ®µä»£ç æœ‰å†²çªï¼š

<<<<<<< HEAD
{ä½ çš„ä»£ç }
=======
{ä»–äººçš„ä»£ç }
>>>>>>> branch

è¯·å¸®æˆ‘åˆå¹¶ï¼Œä¿ç•™ä¸¤è€…çš„åŠŸèƒ½
```

---

### Problem 6.2: PRè¢«æ‹’ç»

**å¸¸è§åŸå› **ï¼š
1. **ä¸ç¬¦åˆè§„èŒƒ**
- æ£€æŸ¥code-review-checklist.md
- ç”¨AI Reviewè‡ªå·±çš„ä»£ç 

2. **æµ‹è¯•ä¸é€šè¿‡**
- æœ¬åœ°è¿è¡Œæ‰€æœ‰æµ‹è¯•
- ä¿®å¤å¤±è´¥çš„æµ‹è¯•

3. **ç¼ºå°‘æ–‡æ¡£**
- è¡¥å……PRæè¿°
- æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## ğŸ†˜ æ±‚åŠ©æµç¨‹

### 1. è‡ªå·±å°è¯•è§£å†³ï¼ˆ15åˆ†é’Ÿï¼‰
- æŸ¥æœ¬æ–‡æ¡£
- æŸ¥FAQ
- æŸ¥Google/StackOverflow

### 2. AIè¾…åŠ©è¯Šæ–­ï¼ˆ10åˆ†é’Ÿï¼‰
```
@é”™è¯¯ä¿¡æ¯
@ç›¸å…³ä»£ç 

é—®é¢˜ï¼š{æè¿°é—®é¢˜}
å·²å°è¯•ï¼š{å°è¯•çš„æ–¹æ¡ˆ}

è¯·å¸®æˆ‘è¯Šæ–­å’Œè§£å†³
```

### 3. å›¢é˜Ÿæ±‚åŠ©
- Slack/é’‰é’‰æ±‚åŠ©
- é™„å¸¦ï¼š
  - é—®é¢˜æè¿°
  - é”™è¯¯ä¿¡æ¯
  - å·²å°è¯•æ–¹æ¡ˆ
  - ç›¸å…³ä»£ç 

### 4. åˆ›å»ºIssue
å¦‚æœæ˜¯å·¥å…·/æ¡†æ¶bugï¼Œåˆ›å»ºIssueï¼š
- æœ€å°å¯å¤ç°ç¤ºä¾‹
- ç¯å¢ƒä¿¡æ¯
- è¯¦ç»†æè¿°

---

## ğŸ“‹ å¿«é€Ÿè¯Šæ–­æ¸…å•

é‡åˆ°é—®é¢˜æ—¶ï¼ŒæŒ‰é¡ºåºæ£€æŸ¥ï¼š

### ç¼–è¯‘é—®é¢˜
- [ ] go mod tidy
- [ ] go clean -cache
- [ ] æ£€æŸ¥importè·¯å¾„
- [ ] æ£€æŸ¥å¾ªç¯ä¾èµ–

### è¿è¡Œé—®é¢˜
- [ ] æ£€æŸ¥é…ç½®æ–‡ä»¶
- [ ] æ£€æŸ¥æ•°æ®åº“è¿æ¥
- [ ] æ£€æŸ¥ç«¯å£å ç”¨
- [ ] æŸ¥çœ‹æ—¥å¿—

### æµ‹è¯•é—®é¢˜
- [ ] æ¸…ç†æµ‹è¯•æ•°æ®
- [ ] æ£€æŸ¥Mockè®¾ç½®
- [ ] éš”ç¦»æµ‹è¯•ç¯å¢ƒ
- [ ] æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š

### AIå·¥å…·é—®é¢˜
- [ ] æ£€æŸ¥é…ç½®æ–‡ä»¶
- [ ] é‡å¯å·¥å…·
- [ ] å®Œå–„Prompt
- [ ] å¼•ç”¨è§„èŒƒ

---

**é‡åˆ°é—®é¢˜åˆ«æ…Œï¼Œç…§ç€æ’æŸ¥ï¼** ğŸ”
