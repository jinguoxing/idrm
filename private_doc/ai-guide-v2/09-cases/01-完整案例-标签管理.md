# å®æˆ˜æ¡ˆä¾‹ï¼šä»éœ€æ±‚åˆ°ä¸Šçº¿

> å®Œæ•´æ¡ˆä¾‹æ¼”ç¤º5é˜¶æ®µå·¥ä½œæµ

---

## ğŸ“‹ æ¡ˆä¾‹æ¦‚è¿°

**åŠŸèƒ½**ï¼šæ·»åŠ æ•°æ®æ ‡ç­¾ï¼ˆTagï¼‰ç®¡ç†  
**å¤æ‚åº¦**ï¼šä¸­ç­‰ï¼ˆçº¦400è¡Œï¼‰  
**å·¥å…·**ï¼šKiro.dev + Cursor  
**è€—æ—¶**ï¼š1ä¸ªå·¥ä½œæ—¥

---

## ğŸ¯ éœ€æ±‚èƒŒæ™¯

æ•°æ®ç®¡ç†å‘˜å¸Œæœ›ä¸ºæ•°æ®èµ„æºæ‰“æ ‡ç­¾ï¼Œä¾¿äºåˆ†ç±»å’Œæ£€ç´¢ã€‚

**æ ¸å¿ƒéœ€æ±‚**ï¼š
- åˆ›å»º/åˆ é™¤æ ‡ç­¾
- ä¸ºèµ„æºæ‰“æ ‡ç­¾
- æŒ‰æ ‡ç­¾æŸ¥è¯¢èµ„æº
- æ ‡ç­¾ç»Ÿè®¡

---

## ğŸ“ Phase 0: Context (15åˆ†é’Ÿ)

### Step 1: é˜…è¯»è§„èŒƒ

```
å·²é˜…è¯»ï¼š
âœ… project-charter.md
âœ… workflow.md
âœ… layered-architecture.md
âœ… go-style-guide.md
```

### Step 2: ç¯å¢ƒæ£€æŸ¥

```bash
# ä»£ç æœ€æ–°
git pull origin main

# ç¼–è¯‘é€šè¿‡
go build ./...
âœ… Success

# æ•°æ®åº“è¿è¡Œ
docker ps | grep mysql
âœ… Running
```

### Step 3: åˆ›å»ºåˆ†æ”¯

```bash
git checkout -b feature/tag-management
```

---

## ğŸ“‹ Phase 1: Specify (30åˆ†é’Ÿ)

### ä½¿ç”¨Kiro.dev

**åˆ›å»ºSpec**ï¼š
```
Kiro â†’ New Spec
åç§°ï¼šTag Management
```

**æè¿°åŠŸèƒ½**ï¼š
```
æˆ‘è¦æ·»åŠ æ•°æ®æ ‡ç­¾ç®¡ç†åŠŸèƒ½

åŠŸèƒ½åŒ…æ‹¬ï¼š
1. CRUDæ ‡ç­¾
2. ä¸ºèµ„æºï¼ˆæ•°æ®ç›®å½•ï¼‰æ‰“æ ‡ç­¾
3. æŒ‰æ ‡ç­¾æŸ¥è¯¢èµ„æº
4. æ ‡ç­¾ä½¿ç”¨ç»Ÿè®¡

çº¦æŸï¼š
- æ ‡ç­¾åç§°å”¯ä¸€
- ä¸€ä¸ªèµ„æºå¯ä»¥æœ‰å¤šä¸ªæ ‡ç­¾
- éµå¾ªIDRMè§„èŒƒ
```

### Kiroç”ŸæˆRequirements

```markdown
# Requirements: Tag Management

## User Stories

### Story 1: åˆ›å»ºæ ‡ç­¾
AS a æ•°æ®ç®¡ç†å‘˜
I WANT åˆ›å»ºæ–°æ ‡ç­¾
SO THAT æˆ‘å¯ä»¥ä¸ºæ•°æ®èµ„æºåˆ†ç±»

### Story 2: æ‰“æ ‡ç­¾
AS a æ•°æ®ç®¡ç†å‘˜  
I WANT ä¸ºæ•°æ®èµ„æºæ‰“æ ‡ç­¾
SO THAT æˆ‘å¯ä»¥å¿«é€Ÿç»„ç»‡å’ŒæŸ¥æ‰¾æ•°æ®

### Story 3: æŒ‰æ ‡ç­¾æŸ¥è¯¢
AS a æ•°æ®ä½¿ç”¨è€…
I WANT æŒ‰æ ‡ç­¾æŸ¥è¯¢æ•°æ®èµ„æº
SO THAT æˆ‘å¯ä»¥å¿«é€Ÿæ‰¾åˆ°ç›¸å…³æ•°æ®

## Acceptance Criteria (EARS)

### åˆ›å»ºæ ‡ç­¾
WHEN ç”¨æˆ·åˆ›å»ºæ ‡ç­¾æ—¶æäº¤æœ‰æ•ˆçš„æ ‡ç­¾åç§°
THE SYSTEM SHALL ä¿å­˜æ ‡ç­¾å¹¶è¿”å›æ ‡ç­¾ID

WHEN ç”¨æˆ·æäº¤çš„æ ‡ç­¾åç§°å·²å­˜åœ¨
THE SYSTEM SHALL è¿”å›409é”™è¯¯å’Œ"æ ‡ç­¾å·²å­˜åœ¨"

### æ‰“æ ‡ç­¾
WHEN ç”¨æˆ·ä¸ºèµ„æºæ·»åŠ æ ‡ç­¾
THE SYSTEM SHALL å»ºç«‹èµ„æºä¸æ ‡ç­¾çš„å…³è”

WHEN ç”¨æˆ·ä¸ºä¸å­˜åœ¨çš„èµ„æºæ‰“æ ‡ç­¾  
THE SYSTEM SHALL è¿”å›404é”™è¯¯

### æŸ¥è¯¢
WHEN ç”¨æˆ·æŒ‰æ ‡ç­¾æŸ¥è¯¢èµ„æº
THE SYSTEM SHALL è¿”å›æ‰€æœ‰åŒ…å«è¯¥æ ‡ç­¾çš„èµ„æºåˆ—è¡¨

## Technical Constraints
- MUST follow layered architecture
- Functions MUST be < 50 lines
- MUST use Chinese comments
- Test coverage MUST be > 80%

## Data Model

### tagsè¡¨
\`\`\`sql
CREATE TABLE tags (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL UNIQUE,
    color VARCHAR(7),
    created_at DATETIME NOT NULL,
    updated_at DATETIME NOT NULL
);
\`\`\`

### resource_tagsè¡¨ï¼ˆå…³è”è¡¨ï¼‰
\`\`\`sql
CREATE TABLE resource_tags (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    resource_id BIGINT NOT NULL,
    tag_id BIGINT NOT NULL,
    created_at DATETIME NOT NULL,
    UNIQUE KEY uk_resource_tag (resource_id, tag_id)
);
\`\`\`
```

### Gate 1æ£€æŸ¥

- [x] User storieså®Œæ•´
- [x] EARSæ ¼å¼æ­£ç¡®
- [x] Technical constraintsæ˜ç¡®
- [x] Data modelæ¸…æ™°

**âœ… Pass**

---

## ğŸ¨ Phase 2: Design (40åˆ†é’Ÿ)

### Kiroç”ŸæˆDesign

```markdown
# Design: Tag Management

## Architecture

\`\`\`
Handler â†’ Logic â†’ Model
\`\`\`

## File Structure

### Modelå±‚
model/resource_catalog/tag/
â”œâ”€â”€ interface.go
â”œâ”€â”€ types.go
â”œâ”€â”€ gorm_dao.go
â””â”€â”€ factory.go

### Logicå±‚
api/internal/logic/resource_catalog/tag/
â”œâ”€â”€ createtaglogic.go
â”œâ”€â”€ deletetaglogic.go
â”œâ”€â”€ assigntaglogic.go
â”œâ”€â”€ querybytaglogic.go
â””â”€â”€ tagstatslogic.go

### Handlerå±‚
api/internal/handler/resource_catalog/tag/
â”œâ”€â”€ createtaghandler.go
â”œâ”€â”€ deletetaghandler.go
â”œâ”€â”€ assigntaghandler.go
â”œâ”€â”€ querybytaghandler.go
â””â”€â”€ tagstatshandler.go

## Interfaces

### Model Interface
\`\`\`go
type Model interface {
    // Tag CRUD
    Insert(ctx context.Context, tag *Tag) error
    FindByID(ctx context.Context, id int64) (*Tag, error)
    List(ctx context.Context, page, size int) ([]*Tag, int64, error)
    Delete(ctx context.Context, id int64) error
    FindByName(ctx context.Context, name string) (*Tag, error)
    
    // Resource-Tag association
    AssignTag(ctx context.Context, resourceID, tagID int64) error
    RemoveTag(ctx context.Context, resourceID, tagID int64) error
    GetResourceTags(ctx context.Context, resourceID int64) ([]*Tag, error)
    GetResourcesByTag(ctx context.Context, tagID int64) ([]int64, error)
    
    // Stats
    GetTagStats(ctx context.Context) ([]*TagStat, error)
}
\`\`\`

## Sequence Diagram: æ‰“æ ‡ç­¾

\`\`\`mermaid
sequenceDiagram
    Client->>Handler: POST /resources/:id/tags
    Handler->>Logic: AssignTag(resourceID, tagID)
    Logic->>Model: FindByID(resourceID)
    Model-->>Logic: resource
    Logic->>Model: FindByID(tagID)
    Model-->>Logic: tag
    Logic->>Model: AssignTag(resourceID, tagID)
    Model-->>Logic: nil
    Logic-->>Handler: success
    Handler-->>Client: 200 OK
\`\`\`
```

### Gate 2æ£€æŸ¥

- [x] ç¬¦åˆåˆ†å±‚æ¶æ„
- [x] æ–‡ä»¶æ¸…å•å®Œæ•´
- [x] æ¥å£å®šä¹‰æ¸…æ™°
- [x] åºåˆ—å›¾å®Œæ•´

**âœ… Pass**

---

## ğŸ“‹ Phase 3: Tasksï¼ˆ20åˆ†é’Ÿï¼‰

### Kiroç”ŸæˆTasks

```markdown
# Tasks: Tag Management

æ€»è®¡ï¼š12ä¸ªtasks
é¢„ä¼°è¡Œæ•°ï¼š~400è¡Œ
é¢„ä¼°æ—¶é—´ï¼š6-8å°æ—¶

## Task 1: åˆ›å»ºTag Modelæ¥å£
Lines: 40
Files: interface.go, types.go
Status: â¸ï¸

## Task 2: å®ç°Tag GORM DAO
Lines: 80
Depends: Task 1
Files: gorm_dao.go
Status: â¸ï¸

## Task 3: å®ç°Factory
Lines: 30
Depends: Task 2
Files: factory.go
Status: â¸ï¸

## Task 4-8: Logicå±‚ï¼ˆæ¯ä¸ª35-40è¡Œï¼‰
Depends: Task 3

## Task 9-11: Handlerå±‚ï¼ˆæ¯ä¸ª30è¡Œï¼‰
Depends: Task 4-8

## Task 12: å•å…ƒæµ‹è¯•
Lines: 120
Depends: All
```

### Gate 3æ£€æŸ¥

- [x] æ¯ä¸ªtask <80è¡Œ
- [x] ä¾èµ–æ¸…æ™°
- [x] éªŒæ”¶æ ‡å‡†æ˜ç¡®

**âœ… Pass**

---

## ğŸ’» Phase 4: Implement (4-6å°æ—¶)

### Task 1-3: Modelå±‚ï¼ˆ1.5å°æ—¶ï¼‰

**ä½¿ç”¨Cursor**ï¼š
```
@tasks.md
@spec/architecture/dual-orm-pattern.md

æ‰§è¡ŒTask 1: åˆ›å»ºTag Modelæ¥å£

è¦æ±‚ï¼š
- å®Œæ•´çš„Modelæ¥å£
- Tagå’ŒResourceTagç»“æ„ä½“
- é”™è¯¯å®šä¹‰
- ä¸­æ–‡æ³¨é‡Š
```

**ç”Ÿæˆç»“æœ**ï¼š
- interface.go âœ…
- types.go âœ…
- errors.go âœ…

**æ‰§è¡ŒTask 2**ï¼š
```
@tasks.md  
@model/resource_catalog/tag/interface.go

æ‰§è¡ŒTask 2: å®ç°GORM DAO

è¦æ±‚ï¼š
- å®ç°æ‰€æœ‰Modelæ¥å£æ–¹æ³•
- ä½¿ç”¨GORM
- äº‹åŠ¡å¤„ç†
- ä¸­æ–‡æ³¨é‡Š
```

**ç”Ÿæˆç»“æœ**ï¼š
- gorm_dao.go âœ…

**æµ‹è¯•**ï¼š
```bash
go test ./model/resource_catalog/tag/
PASS
coverage: 88.5%
```

**Commit**ï¼š
```bash
git add model/resource_catalog/tag/
git commit -m "feat: add tag model interface and gorm implementation"
```

---

### Task 4-8: Logicå±‚ï¼ˆ2å°æ—¶ï¼‰

**é€ä¸ªæ‰§è¡Œ**ï¼š
```
Task 4: createtaglogic.go
Task 5: assigntaglogic.go
Task 6: querybytaglogic.go
...
```

**Cursor Promptæ¨¡æ¿**ï¼š
```
@tasks.md
@model/resource_catalog/tag/interface.go
@spec/coding-standards/go-style-guide.md

æ‰§è¡ŒTask {N}: {ä»»åŠ¡å}

è¦æ±‚ï¼š
- è°ƒç”¨Modelæ¥å£
- å®Œæ•´ä¸šåŠ¡é€»è¾‘
- é”™è¯¯å¤„ç†
- <50è¡Œ
- ä¸­æ–‡æ³¨é‡Š
```

**æµ‹è¯•**ï¼š
```bash
go test ./api/internal/logic/resource_catalog/tag/
PASS
coverage: 85.2%
```

---

### Task 9-11: Handlerå±‚ï¼ˆ1.5å°æ—¶ï¼‰

**Cursorç”ŸæˆHandler**ï¼š
```
@tasks.md
@logic/resource_catalog/tag/*.go
@spec/architecture/api-design-guide.md

æ‰§è¡ŒTask {N}: {Handlerå}

è¦æ±‚ï¼š
- å‚æ•°ç»‘å®šéªŒè¯
- è°ƒç”¨Logic
- ç»Ÿä¸€å“åº”æ ¼å¼
- ä¸­æ–‡æ³¨é‡Š
```

**APIæµ‹è¯•**ï¼š
```bash
# å¯åŠ¨æœåŠ¡
go run api/api.go

# æµ‹è¯•åˆ›å»ºæ ‡ç­¾
curl -X POST http://localhost:8888/api/v1/tags \
  -d '{"name":"é‡è¦æ•°æ®","color":"#FF0000"}'

# æµ‹è¯•æ‰“æ ‡ç­¾
curl -X POST http://localhost:8888/api/v1/resources/1/tags \
  -d '{"tag_id":1}'

# æµ‹è¯•æŸ¥è¯¢
curl http://localhost:8888/api/v1/tags/1/resources
```

---

### Task 12: æµ‹è¯•ï¼ˆ1å°æ—¶ï¼‰

**è¡¥å……æµ‹è¯•**ï¼š
```
@logic/createtaglogic.go
@spec/coding-standards/testing-standards.md

ä¸ºè¿™ä¸ªLogicç”Ÿæˆå®Œæ•´çš„å•å…ƒæµ‹è¯•
è¦æ±‚ï¼š
- è¡¨é©±åŠ¨æµ‹è¯•
- Mock Model
- è¦†ç›–æ‰€æœ‰åˆ†æ”¯
```

**è¦†ç›–ç‡æ£€æŸ¥**ï¼š
```bash
go test -cover ./...
model/resource_catalog/tag  coverage: 88.5%
logic/resource_catalog/tag  coverage: 85.2%
handler/resource_catalog/tag coverage: 82.1%

æ€»ä½“è¦†ç›–ç‡: 85.3% âœ…
```

---

## âœ… Gate 4: è´¨é‡æ£€æŸ¥

### è‡ªåŠ¨åŒ–æ£€æŸ¥

```bash
# ç¼–è¯‘
go build ./...
âœ… Success

# æµ‹è¯•
go test ./...
âœ… All Pass

# è¦†ç›–ç‡
go test -cover ./...
âœ… 85.3% > 80%

# Lint
golangci-lint run
âœ… No issues
```

### Code Review

**Self Review**ï¼š
- [x] æ¶æ„åˆè§„
- [x] å‡½æ•°<50è¡Œ
- [x] ä¸­æ–‡æ³¨é‡Š
- [x] é”™è¯¯å¤„ç†

**åˆ›å»ºPR**ï¼š
```bash
git push origin feature/tag-management
```

**PRæè¿°**ï¼š
```markdown
## åŠŸèƒ½ï¼šæ•°æ®æ ‡ç­¾ç®¡ç†

### å˜æ›´
- Model: Tagçš„GORMå®ç°
- Logic: æ ‡ç­¾CRUDå’Œå…³è”é€»è¾‘  
- Handler: 5ä¸ªREST API
- æµ‹è¯•: 85.3%è¦†ç›–ç‡

### API
- POST /api/v1/tags
- DELETE /api/v1/tags/:id
- POST /api/v1/resources/:id/tags
- GET /api/v1/tags/:id/resources
- GET /api/v1/tags/stats

### æµ‹è¯•
âœ… ç¼–è¯‘é€šè¿‡
âœ… æµ‹è¯•é€šè¿‡
âœ… Linté€šè¿‡
âœ… è¦†ç›–ç‡85.3%
```

**Peer Review â†’ Approved**

**åˆå¹¶ä»£ç **ï¼š
```bash
git checkout main
git merge feature/tag-management
git push origin main
```

---

## ğŸ“Š æ€»ç»“

### æ—¶é—´æ¶ˆè€—

| Phase | é¢„è®¡ | å®é™… | åå·® |
|-------|------|------|------|
| Phase 0 | 15min | 15min | 0 |
| Phase 1 | 30min | 30min | 0 |
| Phase 2 | 40min | 40min | 0 |
| Phase 3 | 20min | 20min | 0 |
| Phase 4 | 6h | 5.5h | -30min |
| **æ€»è®¡** | **7.5h** | **7h** | **-30min** |

### ä»£ç ç»Ÿè®¡

- æ€»è¡Œæ•°ï¼š398è¡Œ
- Model: 150è¡Œ
- Logic: 180è¡Œ
- Handler: 150è¡Œ
- æµ‹è¯•: 220è¡Œ
- è¦†ç›–ç‡ï¼š85.3%

### ç»éªŒæ•™è®­

**âœ… åšå¾—å¥½çš„**ï¼š
1. Kiroè§„åˆ’æ¸…æ™°ï¼ŒèŠ‚çœæ—¶é—´
2. åˆ†é˜¶æ®µæ‰§è¡Œï¼Œæ¯æ­¥éªŒè¯
3. AIè¾…åŠ©æ•ˆç‡é«˜
4. æµ‹è¯•è¦†ç›–å……åˆ†

**âš ï¸ å¯æ”¹è¿›çš„**ï¼š
1. åˆæœŸå¯¹éœ€æ±‚ç†è§£ä¸å¤Ÿæ·±
2. æœ‰äº›æµ‹è¯•ç”¨ä¾‹é—æ¼
3. Handlerå±‚å¯ä»¥æ›´æ—©æµ‹è¯•

**ğŸ’¡ å»ºè®®**ï¼š
1. Phase 1å¤šèŠ±æ—¶é—´ï¼Œåé¢æ›´é¡º
2. è¾¹å®ç°è¾¹æµ‹è¯•
3. å……åˆ†åˆ©ç”¨AIä½†è¦Review

---

**å®Œæ•´æ¡ˆä¾‹æ¼”ç¤ºå®Œæ¯•ï¼** ğŸ‰
