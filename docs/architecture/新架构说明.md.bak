# IDRM æ–°æ¶æ„è¯´æ˜

## ğŸ“ æ–°çš„ç›®å½•ç»“æ„

é¡¹ç›®å·²è°ƒæ•´ä¸ºç¬¦åˆgo-zeroè§„èŒƒçš„ç›®å½•ç»“æ„ï¼š

```
idrm/
â”œâ”€â”€ api/                    # ç»Ÿä¸€APIæœåŠ¡ï¼ˆå•ä¸€å…¥å£ï¼‰
â”‚   â”œâ”€â”€ api.go              # mainå…¥å£
â”‚   â”œâ”€â”€ api.api             # APIå®šä¹‰æ–‡ä»¶
â”‚   â”œâ”€â”€ etc/api.yaml        # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ internal/
â”‚       â”œâ”€â”€ config/         # é…ç½®ç»“æ„
â”‚       â”œâ”€â”€ handler/        # æŒ‰æ¨¡å—ç»„ç»‡
â”‚       â”œâ”€â”€ logic/          # æŒ‰æ¨¡å—ç»„ç»‡
â”‚       â”œâ”€â”€ svc/            # ServiceContext
â”‚       â””â”€â”€ types/          # ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ model/                  # Modelå±‚ï¼ˆåŒORMæ”¯æŒï¼‰
â”‚   â””â”€â”€ resource_catalog/
â”‚       â”œâ”€â”€ interface.go    # ç»Ÿä¸€æ¥å£
â”‚       â”œâ”€â”€ types.go        # å…±äº«å®ä½“
â”‚       â”œâ”€â”€ vars.go         # å¸¸é‡/é”™è¯¯
â”‚       â”œâ”€â”€ sqlx/           # sqlxå®ç°
â”‚       â””â”€â”€ gorm/           # gormå®ç°
â”‚
â”œâ”€â”€ rpc/                    # RPCæœåŠ¡
â”œâ”€â”€ job/                    # å®šæ—¶ä»»åŠ¡
â”œâ”€â”€ consumer/               # æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹
â”œâ”€â”€ pkg/                    # å…¬å…±ä»£ç 
â””â”€â”€ docs/                   # æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

###  1. å¯åŠ¨APIæœåŠ¡

```bash
cd api
go run api.go -f etc/api.yaml
```

### 2. é…ç½®ORM

ç¼–è¾‘ `api/etc/api.yaml`ï¼š

```yaml
# é€‰æ‹©ORMï¼šsqlx æˆ– gorm
ORM: sqlx  # æ”¹ä¸º gorm å³å¯åˆ‡æ¢åˆ°gorm
```

### 3. ä½¿ç”¨goctlç”Ÿæˆä»£ç 

```bash
cd api
goctl api go -api api.api -dir .
```

## ğŸ”‘ æ ¸å¿ƒç‰¹æ€§

### 1. ç»Ÿä¸€APIå…¥å£

æ‰€æœ‰æ¨¡å—åœ¨ä¸€ä¸ªAPIæœåŠ¡ä¸­ï¼Œé€šè¿‡æ¨¡å—åŒ–ç»„ç»‡ï¼š

- `handler/resource_catalog/` - èµ„æºç›®å½•æ¨¡å—
- `handler/data_view/` - æ•°æ®è§†å›¾æ¨¡å—
- `handler/data_understanding/` - æ•°æ®ç†è§£æ¨¡å—

### 2. åŒORMæ”¯æŒ

Modelå±‚åŒæ—¶å®ç°sqlxå’Œgormï¼š

```go
// é€šè¿‡æ¥å£æŠ½è±¡
type CategoryModel interface {
    FindOne(ctx, id) (*Category, error)
    // ...
}

// sqlxå®ç°
func NewCategoryModel(conn sqlx.SqlConn) CategoryModel

// gormå®ç°
func NewCategoryModel(db *gorm.DB) CategoryModel
```

é…ç½®æ–‡ä»¶æ§åˆ¶ä½¿ç”¨å“ªç§ORMï¼Œä¸šåŠ¡ä»£ç æ— éœ€æ”¹åŠ¨ã€‚

### 3. ç¬¦åˆgo-zeroè§„èŒƒ

å®Œå…¨éµå¾ªgo-zeroå’Œgoctlçš„æ ‡å‡†ç»“æ„ï¼Œå¯å®‰å…¨ä½¿ç”¨goctlå·¥å…·ã€‚

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æ¥å£

1. ç¼–è¾‘ `api/api.api` æ·»åŠ æ¥å£å®šä¹‰
2. è¿è¡Œ `goctl api go -api api.api -dir .`
3. åœ¨ç”Ÿæˆçš„logicä¸­å®ç°ä¸šåŠ¡é€»è¾‘

### æ·»åŠ æ–°æ¨¡å—

1. åœ¨ `handler/` å’Œ `logic/` ä¸‹åˆ›å»ºæ¨¡å—ç›®å½•
2. åˆ›å»º `routes.go` æ³¨å†Œè·¯ç”±
3. åœ¨ `handler/routes.go` ä¸­è°ƒç”¨æ¨¡å—çš„RegisterHandlers

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **types.goä¼šè¢«è¦†ç›–**ï¼šä½¿ç”¨goctlæ—¶æ³¨æ„å¤‡ä»½
2. **æ•°æ®åº“é…ç½®**ï¼šä¿®æ”¹`api/etc/api.yaml`ä¸­çš„æ•°æ®åº“è¿æ¥
3. **ORMåˆ‡æ¢**ï¼šä¿®æ”¹`ORM`é…ç½®é¡¹å³å¯åˆ‡æ¢sqlx/gorm

## ğŸ”„ ä»æ—§ç»“æ„è¿ç§»

æ—§çš„ `cmd/` å’Œ `app/` ç›®å½•å·²åºŸå¼ƒï¼Œä½¿ç”¨æ–°çš„ `api/` ç»“æ„ã€‚

å…·ä½“è¿ç§»æ­¥éª¤è§ `implementation_plan.md`ã€‚
