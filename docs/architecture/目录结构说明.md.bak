# IDRM é¡¹ç›®ç›®å½•ç»“æ„è¯´æ˜

## ğŸ“‚ å®Œæ•´ç›®å½•æ ‘

```
idrm/
â”œâ”€â”€ cmd/                              # æœåŠ¡å…¥å£ï¼ˆ3ä¸ªç‹¬ç«‹æœåŠ¡ï¼‰
â”‚   â”œâ”€â”€ api-server/                   # HTTP APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ main.go                   # APIæœåŠ¡å…¥å£
â”‚   â”‚   â””â”€â”€ etc/
â”‚   â”‚       â””â”€â”€ api-server.yaml       # APIæœåŠ¡é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ job-server/                   # å®šæ—¶ä»»åŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ main.go                   # JobæœåŠ¡å…¥å£
â”‚   â”‚   â””â”€â”€ etc/
â”‚   â”‚       â””â”€â”€ job-server.yaml       # JobæœåŠ¡é…ç½®
â”‚   â”‚
â”‚   â””â”€â”€ consumer-server/              # æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹æœåŠ¡
â”‚       â”œâ”€â”€ main.go                   # ConsumeræœåŠ¡å…¥å£
â”‚       â””â”€â”€ etc/
â”‚           â””â”€â”€ consumer-server.yaml  # ConsumeræœåŠ¡é…ç½®
â”‚
â”œâ”€â”€ app/                              # åº”ç”¨å±‚ï¼ˆä¸šåŠ¡å…¥å£ï¼‰
â”‚   â”œâ”€â”€ api/                          # APIå±‚ï¼ˆç®€å•HTTPæ¥å£ï¼‰
â”‚   â”‚   â”œâ”€â”€ data_view/               # æ•°æ®è§†å›¾API
â”‚   â”‚   â”‚   â”œâ”€â”€ handler/             # HTTPå¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ types/               # è¯·æ±‚/å“åº”ç±»å‹
â”‚   â”‚   â”‚   â””â”€â”€ routes.go            # è·¯ç”±æ³¨å†Œ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ data_understanding/      # æ•°æ®ç†è§£API
â”‚   â”‚   â””â”€â”€ resource_catalog/        # èµ„æºç›®å½•API
â”‚   â”‚       â”œâ”€â”€ handler/
â”‚   â”‚       â”‚   â””â”€â”€ category_handler.go
â”‚   â”‚       â””â”€â”€ routes.go
â”‚   â”‚
â”‚   â”œâ”€â”€ bff/                          # BFFå±‚ï¼ˆå¤æ‚ä¸šåŠ¡èšåˆï¼‰
â”‚   â”‚   â”œâ”€â”€ admin/                   # åå°ç®¡ç†BFF
â”‚   â”‚   â”‚   â”œâ”€â”€ handler/
â”‚   â”‚   â”‚   â””â”€â”€ logic/               # ä¸šåŠ¡ç¼–æ’é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ web/                     # Webç«¯BFF
â”‚   â”‚   â””â”€â”€ mobile/                  # ç§»åŠ¨ç«¯BFF
â”‚   â”‚
â”‚   â”œâ”€â”€ job/                          # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ sync_data/               # æ•°æ®åŒæ­¥ä»»åŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ sync_data_job.go
â”‚   â”‚   â”œâ”€â”€ statistics/              # ç»Ÿè®¡ä»»åŠ¡
â”‚   â”‚   â””â”€â”€ cleanup/                 # æ¸…ç†ä»»åŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ consumer/                     # æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹è€…
â”‚   â”‚   â”œâ”€â”€ data_view_consumer/      # æ•°æ®è§†å›¾æ¶ˆè´¹è€…
â”‚   â”‚   â””â”€â”€ catalog_consumer/        # ç›®å½•æ¶ˆè´¹è€…
â”‚   â”‚       â””â”€â”€ catalog_consumer.go
â”‚   â”‚
â”‚   â””â”€â”€ rpc/                          # RPCå±‚ï¼ˆå¯é€‰ï¼‰
â”‚       â”œâ”€â”€ data_view/               # æ•°æ®è§†å›¾RPC
â”‚       â”‚   â”œâ”€â”€ proto/
â”‚       â”‚   â””â”€â”€ internal/
â”‚       â”œâ”€â”€ data_understanding/      # æ•°æ®ç†è§£RPC
â”‚       â””â”€â”€ resource_catalog/        # èµ„æºç›®å½•RPC
â”‚
â”œâ”€â”€ domain/                           # é¢†åŸŸå±‚ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ data_view/                   # æ•°æ®è§†å›¾é¢†åŸŸ
â”‚   â”‚   â”œâ”€â”€ entity/                  # é¢†åŸŸå®ä½“
â”‚   â”‚   â”œâ”€â”€ repository/              # ä»“å‚¨æ¥å£
â”‚   â”‚   â””â”€â”€ service/                 # é¢†åŸŸæœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ data_understanding/          # æ•°æ®ç†è§£é¢†åŸŸ
â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â””â”€â”€ service/
â”‚   â”‚
â”‚   â””â”€â”€ resource_catalog/            # èµ„æºç›®å½•é¢†åŸŸ
â”‚       â”œâ”€â”€ entity/
â”‚       â”‚   â”œâ”€â”€ category.go          # ç±»åˆ«å®ä½“
â”‚       â”‚   â””â”€â”€ errors.go
â”‚       â”œâ”€â”€ repository/
â”‚       â”‚   â””â”€â”€ category_repository.go
â”‚       â””â”€â”€ service/
â”‚           â””â”€â”€ category_service.go
â”‚
â”œâ”€â”€ infrastructure/                   # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ persistence/                 # æ•°æ®æŒä¹…åŒ–
â”‚   â”‚   â”œâ”€â”€ mysql/                   # MySQLå®ç°
â”‚   â”‚   â”‚   â””â”€â”€ category_repository_impl.go
â”‚   â”‚   â”œâ”€â”€ redis/                   # Rediså®ç°
â”‚   â”‚   â””â”€â”€ elasticsearch/           # ESå®ç°ï¼ˆå¯é€‰ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ mq/                          # æ¶ˆæ¯é˜Ÿåˆ—
â”‚   â”‚   â””â”€â”€ kafka/
â”‚   â”‚       â””â”€â”€ kafka.go             # Kafkaå°è£…
â”‚   â”‚
â”‚   â””â”€â”€ external/                    # å¤–éƒ¨æœåŠ¡è°ƒç”¨
â”‚
â”œâ”€â”€ pkg/                              # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ config/                      # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ api_config.go
â”‚   â”‚   â”œâ”€â”€ job_config.go
â”‚   â”‚   â””â”€â”€ consumer_config.go
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/                  # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth_middleware.go
â”‚   â”‚   â””â”€â”€ cors_middleware.go
â”‚   â”‚
â”‚   â”œâ”€â”€ response/                    # ç»Ÿä¸€å“åº”
â”‚   â”‚   â””â”€â”€ response.go
â”‚   â”‚
â”‚   â”œâ”€â”€ errorx/                      # é”™è¯¯å¤„ç†
â”‚   â”‚   â””â”€â”€ errorx.go
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ logger/                      # æ—¥å¿—å°è£…
â”‚
â”œâ”€â”€ deploy/                           # éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ Dockerfile.api-server
â”‚   â”‚   â”œâ”€â”€ Dockerfile.job-server
â”‚   â”‚   â””â”€â”€ Dockerfile.consumer-server
â”‚   â”‚
â”‚   â”œâ”€â”€ k8s/                         # Kubernetesé…ç½®
â”‚   â”‚   â”œâ”€â”€ api-server/
â”‚   â”‚   â”œâ”€â”€ job-server/
â”‚   â”‚   â””â”€â”€ consumer-server/
â”‚   â”‚
â”‚   â””â”€â”€ docker-compose/              # æœ¬åœ°å¼€å‘ç¯å¢ƒ
â”‚       â””â”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ scripts/                          # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ init-db.sh                   # åˆå§‹åŒ–æ•°æ®åº“
â”‚   â”œâ”€â”€ gen-proto.sh                 # ç”ŸæˆProtoä»£ç 
â”‚   â””â”€â”€ build.sh                     # æ„å»ºè„šæœ¬
â”‚
â”œâ”€â”€ migrations/                       # æ•°æ®åº“è¿ç§»
â”‚
â”œâ”€â”€ docs/                             # æ–‡æ¡£
â”‚   â”œâ”€â”€ api/                         # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ architecture/                # æ¶æ„è®¾è®¡
â”‚   â””â”€â”€ deployment/                  # éƒ¨ç½²æ–‡æ¡£
â”‚
â”œâ”€â”€ test/                             # æµ‹è¯•
â”‚   â””â”€â”€ integration/                 # é›†æˆæµ‹è¯•
â”‚
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

## ğŸ“‹ ç›®å½•è¯´æ˜

### cmd/ - æœåŠ¡å…¥å£
åŒ…å«3ä¸ªç‹¬ç«‹æœåŠ¡çš„å¯åŠ¨å…¥å£ï¼š
- **api-server**: HTTP APIæœåŠ¡ï¼Œç«¯å£8080
- **job-server**: å®šæ—¶ä»»åŠ¡æœåŠ¡ï¼Œä½¿ç”¨cronè°ƒåº¦
- **consumer-server**: Kafkaæ¶ˆæ¯æ¶ˆè´¹æœåŠ¡

**ç‰¹ç‚¹**: æ¯ä¸ªæœåŠ¡ç‹¬ç«‹éƒ¨ç½²ï¼Œå¯ç‹¬ç«‹æ‰©ç¼©å®¹

### app/ - åº”ç”¨å±‚
ä¸šåŠ¡çš„å…¥å£å±‚ï¼ŒåŒ…å«4ä¸ªå­å±‚ï¼š

#### api/ - APIå±‚
å¤„ç†ç®€å•çš„HTTPè¯·æ±‚ï¼Œé€‚ç”¨äºï¼š
- ç®€å•CRUDæ“ä½œ
- å•ä¸€DomainæœåŠ¡è°ƒç”¨
- ä¸éœ€è¦å¤æ‚ä¸šåŠ¡ç¼–æ’çš„åœºæ™¯

#### bff/ - BFFå±‚
å¤„ç†å¤æ‚ä¸šåŠ¡èšåˆï¼Œé€‚ç”¨äºï¼š
- éœ€è¦è°ƒç”¨å¤šä¸ªDomainæœåŠ¡
- å¤æ‚çš„ä¸šåŠ¡ç¼–æ’
- æŒ‰ç«¯ï¼ˆAdmin/Web/Mobileï¼‰å®šåˆ¶çš„ä¸šåŠ¡é€»è¾‘

#### job/ - å®šæ—¶ä»»åŠ¡å±‚
æ‰§è¡Œå‘¨æœŸæ€§ä»»åŠ¡ï¼Œå¦‚ï¼š
- æ•°æ®åŒæ­¥
- ç»Ÿè®¡è®¡ç®—
- æ•°æ®æ¸…ç†

#### consumer/ - æ¶ˆè´¹è€…å±‚
å¤„ç†å¼‚æ­¥æ¶ˆæ¯ï¼Œå¦‚ï¼š
- äº‹ä»¶é©±åŠ¨çš„ä¸šåŠ¡é€»è¾‘
- æ•°æ®åŒæ­¥
- å®¡è®¡æ—¥å¿—å¤„ç†

### domain/ - é¢†åŸŸå±‚
**æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚**ï¼Œè¿™æ˜¯æ•´ä¸ªæ¶æ„çš„æ ¸å¿ƒï¼ŒåŒ…å«3ä¸ªå­å±‚ï¼š

#### entity/ - å®ä½“å±‚
- å®šä¹‰ä¸šåŠ¡å¯¹è±¡ï¼ˆå¦‚Categoryã€Directoryï¼‰
- åŒ…å«å®ä½“çš„ä¸šåŠ¡è§„åˆ™å’ŒéªŒè¯é€»è¾‘
- æ˜¯çº¯ç²¹çš„ä¸šåŠ¡å¯¹è±¡ï¼Œä¸ä¾èµ–ä»»ä½•æ¡†æ¶

#### repository/ - ä»“å‚¨æ¥å£å±‚
- å®šä¹‰æ•°æ®è®¿é—®æ¥å£
- **åªå®šä¹‰æ¥å£ï¼Œä¸å®ç°**
- é€šè¿‡æ¥å£éš”ç¦»Domainå’ŒInfrastructure

#### service/ - é¢†åŸŸæœåŠ¡å±‚
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- å¯è¢«APIã€BFFã€Jobã€Consumerå¤ç”¨
- ä¸ä¾èµ–HTTPã€gRPCç­‰ä¼ è¾“å±‚

**é‡è¦åŸåˆ™**:
- âœ… Domainå±‚å¯è¢«æ‰€æœ‰ä¸Šå±‚ï¼ˆappï¼‰è°ƒç”¨
- âŒ Domainå±‚ä¸èƒ½è°ƒç”¨appå±‚
- âŒ Domainä¹‹é—´ä¸èƒ½ç›¸äº’ä¾èµ–

### infrastructure/ - åŸºç¡€è®¾æ–½å±‚
å®ç°Domainå±‚å®šä¹‰çš„æ¥å£ï¼š

#### persistence/ - æŒä¹…åŒ–å®ç°
- MySQL: å®ç°Repositoryæ¥å£
- Redis: ç¼“å­˜å®ç°
- Elasticsearch: æœç´¢å¼•æ“å®ç°

#### mq/ - æ¶ˆæ¯é˜Ÿåˆ—
- Kafkaç”Ÿäº§è€…
- Kafkaæ¶ˆè´¹è€…å°è£…

#### external/ - å¤–éƒ¨æœåŠ¡
- ç¬¬ä¸‰æ–¹APIè°ƒç”¨
- RPCå®¢æˆ·ç«¯

### pkg/ - å…¬å…±åŒ…
å¯è¢«æ‰€æœ‰å±‚å¤ç”¨çš„å·¥å…·åŒ…ï¼š
- **config**: é…ç½®åŠ è½½
- **middleware**: HTTPä¸­é—´ä»¶
- **response**: ç»Ÿä¸€å“åº”æ ¼å¼
- **errorx**: é”™è¯¯ç å®šä¹‰
- **utils**: å·¥å…·å‡½æ•°
- **logger**: æ—¥å¿—å°è£…

## ğŸ”„ ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   appå±‚             â”‚
â”‚ (API/BFF/Job/Consumer)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ è°ƒç”¨
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   domainå±‚          â”‚
â”‚ (Entity/Repository/Service)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ æ¥å£ä¾èµ–
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ infrastructureå±‚    â”‚
â”‚ (MySQL/Redis/Kafka) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   pkgå±‚             â”‚
â”‚ (é€šç”¨å·¥å…·)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è§„åˆ™**:
- å•å‘ä¾èµ–ï¼šä¸Šå±‚ä¾èµ–ä¸‹å±‚
- æ¥å£éš”ç¦»ï¼šDomainå®šä¹‰æ¥å£ï¼ŒInfrastructureå®ç°
- å¤ç”¨åŸåˆ™ï¼šDomainå±‚è¢«æ‰€æœ‰ä¸Šå±‚å…±äº«

## ğŸ“ å‘½åè§„èŒƒ

### ç›®å½•å‘½å
- å°å†™ + ä¸‹åˆ’çº¿ï¼š`data_view`, `resource_catalog`
- GoåŒ…åä¸ç›®å½•åä¸€è‡´

### æ–‡ä»¶å‘½å
- å°å†™ + ä¸‹åˆ’çº¿ï¼š`category_service.go`
- æµ‹è¯•æ–‡ä»¶ï¼š`category_service_test.go`

### ä»£ç å‘½å
- åŒ…åï¼šå°å†™ï¼Œæ— ä¸‹åˆ’çº¿
- ç±»å‹åï¼šå¤§é©¼å³°ï¼ˆPascalCaseï¼‰
- å‡½æ•°/æ–¹æ³•ï¼šå¤§é©¼å³°ï¼ˆå¯¼å‡ºï¼‰æˆ–å°é©¼å³°ï¼ˆç§æœ‰ï¼‰
- å¸¸é‡ï¼šå¤§é©¼å³°æˆ–å…¨å¤§å†™+ä¸‹åˆ’çº¿

## ğŸ¯ è®¾è®¡ä¼˜åŠ¿

1. **æ¸…æ™°çš„åˆ†å±‚**: èŒè´£æ˜ç¡®ï¼Œæ˜“äºç»´æŠ¤
2. **ä»£ç å¤ç”¨**: Domainå±‚è¢«æ‰€æœ‰æœåŠ¡å…±äº«
3. **ç‹¬ç«‹éƒ¨ç½²**: 3ä¸ªæœåŠ¡å¯ç‹¬ç«‹æ‰©ç¼©å®¹
4. **æ˜“äºæµ‹è¯•**: Domainå±‚ä¸ä¾èµ–æ¡†æ¶ï¼Œæ˜“äºå•å…ƒæµ‹è¯•
5. **æ‰©å±•æ€§å¼º**: æ”¯æŒåç»­å¾®æœåŠ¡åŒ–
6. **å¤šæ•°æ®åº“**: æ¯ä¸ªDomainç‹¬ç«‹æ•°æ®åº“ï¼Œæ•°æ®éš”ç¦»
