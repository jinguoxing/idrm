{
    "name": "idrm-review",
    "version": "2.1.0",
    "description": "Code Review - 检查代码是否符合IDRM规范",
    "category": "quality",
    "spec_reference": "sdd_doc/spec/quality/code-review-checklist.md",
    "inputs": {
        "files_to_review": {
            "type": "array",
            "required": true,
            "description": "需要review的文件路径列表"
        },
        "review_type": {
            "type": "string",
            "required": false,
            "default": "full",
            "options": [
                "full",
                "quick",
                "architecture",
                "code_quality",
                "testing"
            ],
            "description": "Review类型"
        }
    },
    "outputs": {
        "review_report": {
            "type": "file",
            "path": "review-report.md"
        }
    },
    "prompt_template": {
        "system": "你是一个Code Review专家，精通IDRM规范和Go最佳实践。进行严格但建设性的代码审查。",
        "user": "Review以下文件：\n{{#files_to_review}}\n@{{.}}\n{{/files_to_review}}\n\nReview类型：{{review_type}}\n\n## Review Checklist\n\n### 架构合规性 (MUST)\n- [ ] 遵循分层架构（Handler → Logic → Model）？\n- [ ] 依赖方向正确（单向依赖）？\n- [ ] Handler层没有业务逻辑？\n- [ ] Logic层没有直接访问数据库？\n- [ ] Model层只负责数据访问？\n\n### 代码质量 (MUST)\n- [ ] 所有函数<50行？\n- [ ] Public函数/类型有中文注释？\n- [ ] 错误处理使用%w包装？\n- [ ] 变量命名清晰、有意义？\n- [ ] 没有magic numbers？\n- [ ] 没有重复代码？\n\n### 错误处理 (MUST)\n- [ ] 所有error都被检查？\n- [ ] 错误信息清晰有用？\n- [ ] 使用自定义错误类型？\n- [ ] HTTP错误映射正确？\n\n### 测试 (MUST)\n- [ ] 使用表驱动测试？\n- [ ] Mock使用正确？\n- [ ] 测试覆盖关键路径？\n- [ ] 测试覆盖异常情况？\n- [ ] 覆盖率>80%？\n\n### 性能 (SHOULD)\n- [ ] 避免N+1查询？\n- [ ] 合理使用索引？\n- [ ] 避免不必要的内存分配？\n\n### 安全 (SHOULD)\n- [ ] 输入验证充分？\n- [ ] SQL注入防护？\n- [ ] 敏感数据处理得当？\n\n### 可维护性 (COULD)\n- [ ] 代码可读性好？\n- [ ] 注释充分但不冗余？\n- [ ] 逻辑清晰易懂？\n\n## Review报告格式\n\n### Summary\n简要总结（2-3句话）\n\n### Issues\n\n#### MUST FIX (阻塞性问题)\n1. **[文件:行号]** 问题描述\n   - 影响：为什么必须修复\n   - 建议：如何修复\n\n#### SHOULD FIX (重要改进)\n1. **[文件:行号]** 问题描述\n   - 影响：为什么应该修复\n   - 建议：如何改进\n\n#### COULD FIX (可选建议)\n1. **[文件:行号]** 建议\n   - 说明：为什么这样更好\n\n### Positive Points\n列出做得好的地方\n\n### Overall Assessment\n- 是否批准合并：YES / NO / CONDITIONAL\n- 条件（如果是CONDITIONAL）：\n\n---\n\n参考规范：\n@sdd_doc/spec/quality/code-review-checklist.md\n@sdd_doc/spec/coding-standards/go-style-guide.md"
    },
    "review_levels": {
        "MUST": {
            "priority": "P0",
            "blocking": true,
            "description": "必须修复的问题，阻塞合并"
        },
        "SHOULD": {
            "priority": "P1",
            "blocking": false,
            "description": "重要的改进建议，强烈建议修复"
        },
        "COULD": {
            "priority": "P2",
            "blocking": false,
            "description": "可选的优化建议"
        }
    },
    "automated_checks": [
        {
            "name": "golangci-lint",
            "command": "golangci-lint run {{files}}",
            "weight": 0.3
        },
        {
            "name": "go test",
            "command": "go test -cover {{packages}}",
            "weight": 0.3
        },
        {
            "name": "go vet",
            "command": "go vet {{packages}}",
            "weight": 0.2
        },
        {
            "name": "staticcheck",
            "command": "staticcheck {{packages}}",
            "weight": 0.2
        }
    ]
}